#!/bin/bash
set -e
set -x

declare -a units
units=(
	nfs-mounts
	rpcbind
	nfs-callback-port
	exportfs
	rpc.nfsd
	rpc.idmapd
	rpc.mountd
)

declare -a started_units

function shutdown {
	local i
	for (( i=${#started_units[@]}-1; i>=0; i-- )); do
		supervisorctl stop "${started_units[$i]}"
	done
}
trap shutdown EXIT

for unit in "${units[@]}"; do
	supervisorctl start "$unit"
	started_units+=( "$unit" )
done

while true; do
	sleep 1d
done
